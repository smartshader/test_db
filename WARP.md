# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Repository Overview

This is the MySQL employees sample database - a widely-used test database containing approximately 300,000 employee records with 2.8 million salary entries. The database serves as a realistic dataset for testing MySQL applications, performance testing, and learning SQL queries.

## Database Architecture

The database consists of 6 main tables with temporal relationships:

- `employees`: Core employee information (300,024 records)
- `departments`: Company departments (9 records) 
- `dept_emp`: Employee-department assignments with date ranges (331,603 records)
- `dept_manager`: Department manager assignments with date ranges (24 records)
- `titles`: Employee job titles with date ranges (443,308 records)
- `salaries`: Employee salary history with date ranges (2,844,047 records)

Key architectural features:
- Temporal data design with from_date/to_date ranges
- Referential integrity with foreign key constraints
- Views for current employee department assignments
- Data intentionally includes inconsistencies for data cleaning exercises

## Installation Commands

**Basic installation:**
```bash
mysql < databases/employees/mysql/employees.sql
```

**Installation with partitioned tables (for large-scale testing):**
```bash
mysql < databases/employees/mysql/employees_partitioned.sql
```

**MySQL 5.1 partitioned version:**
```bash
mysql < databases/employees/mysql/employees_partitioned_5.1.sql
```

## Testing Commands

**Test installation with MD5 checksums:**
```bash
mysql -t < databases/employees/mysql/test_employees_md5.sql
```

**Test installation with SHA checksums:**
```bash
mysql -t < databases/employees/mysql/test_employees_sha.sql
```

**Alternative testing with bash script:**
```bash
databases/employees/mysql/sql_test.sh mysql
# or with specific connection parameters:
databases/employees/mysql/sql_test.sh "mysql -u username -p -h hostname"
```

**Test across multiple MySQL versions (requires dbdeployer):**
```bash
cd databases/employees/mysql && ./test_versions.sh
```

## Working with the Database

**Connect to the database:**
```bash
mysql employees
```

**Load additional sample data (Sakila subset):**
```bash
mysql < databases/sakila/sakila-mv-schema.sql
mysql < databases/sakila/sakila-mv-data.sql
```

**Query current employee departments:**
```sql
SELECT * FROM current_dept_emp LIMIT 10;
```

**View database objects:**
```bash
mysql -e "source databases/employees/mysql/objects.sql" employees
```

## Data Validation

The database includes built-in validation through checksums. Expected values:
- employees: 300,024 records
- departments: 9 records  
- dept_manager: 24 records
- dept_emp: 331,603 records
- titles: 443,308 records
- salaries: 2,844,047 records

Both MD5 and SHA1 checksums are provided for data integrity verification.

## File Structure

**Root directory:**
- `setup.sh` - Interactive setup script for database environments
- `docker-compose.mysql.yml` - MySQL development environment with Adminer
- `docker-compose.postgres.yml` - PostgreSQL development environment with pgAdmin

**databases/employees/mysql/ - MySQL Employee Database:**
- `employees.sql` - Main database schema and data loader
- `employees_partitioned.sql` - Partitioned version for MySQL 5.5+
- `employees_partitioned_5.1.sql` - Partitioned version for MySQL 5.1
- `load_*.dump` - Individual table data dumps
- `test_employees_md5.sql` - MD5-based validation
- `test_employees_sha.sql` - SHA1-based validation
- `sql_test.sh` - Bash-based testing script
- `test_versions.sh` - Multi-version testing script
- `objects.sql` - Additional database objects (views, procedures, functions)
- `show_elapsed.sql` - Performance timing utilities

**databases/employees/postgres/ - PostgreSQL Employee Database:**
- `employees_postgres.sql` - PostgreSQL-compatible schema
- `load_postgres_data.sql` - PostgreSQL data loading script

**databases/sakila/ - Sakila Sample Database:**
- `README.md` - Sakila database documentation
- `sakila-mv-schema.sql` - Sakila database schema
- `sakila-mv-data.sql` - Sakila database data

**init/ - Auto-generated initialization scripts:**
- `mysql/` - MySQL initialization scripts (generated by setup.sh)
- `postgres/` - PostgreSQL initialization scripts (generated by setup.sh)

**Development and Testing:**
- `test_setup.sh` - Comprehensive test suite for setup script
- `Makefile` - Convenient commands for development and testing
- `.github/workflows/test.yml` - GitHub Actions CI/CD pipeline

## Interactive Setup (Recommended)

**Quick setup with interactive script:**
```bash
./setup.sh
```

This interactive script will:
1. Let you choose between MySQL and PostgreSQL
2. Show available sample databases (Employees, Sakila, etc.)
3. Set up the selected database engine with chosen databases
4. Provide connection information and management commands

## Manual Docker Setup

**Start MySQL environment:**
```bash
docker-compose -f docker-compose.mysql.yml up -d
```

**Start PostgreSQL environment:**
```bash
docker-compose -f docker-compose.postgres.yml up -d
```

**Connect to databases:**
```bash
# MySQL
mysql -h localhost -P 3306 -u root -proot test_db

# PostgreSQL
psql -h localhost -p 5432 -U postgres -d test_db
```

**Access web administration interfaces:**
- MySQL (Adminer): http://localhost:8080
- PostgreSQL (pgAdmin): http://localhost:8081
  - Login: admin@test_db.local / admin

**Stop and cleanup:**
```bash
# Stop MySQL environment
docker-compose -f docker-compose.mysql.yml down

# Stop PostgreSQL environment
docker-compose -f docker-compose.postgres.yml down

# Remove volumes (deletes all data)
docker-compose -f docker-compose.mysql.yml down -v
docker-compose -f docker-compose.postgres.yml down -v
```

**Check database status:**
```bash
# MySQL
docker-compose -f docker-compose.mysql.yml logs -f mysql

# PostgreSQL  
docker-compose -f docker-compose.postgres.yml logs -f postgres
```

## Testing and Development

**Run comprehensive test suite:**
```bash
./test_setup.sh
```

**Run quick tests only:**
```bash
./test_setup.sh --quick
```

**Using Makefile for development:**
```bash
# Quick start with employees database
make mysql      # Start MySQL
make postgres   # Start PostgreSQL

# Testing
make test       # Run full test suite
make test-quick # Run quick tests only

# Management
make status     # Check database status
make logs       # View database logs
make stop       # Stop all databases
make clean      # Clean up test environment
```

**Test MySQL fix manually:**
```bash
# Clean up any existing environment
make clean

# Start fresh MySQL setup
echo -e "1\n1\ny" | ./setup.sh

# Verify employees database exists
mysql -h localhost -P 3306 -u root -proot -e "SHOW DATABASES;"
mysql -h localhost -P 3306 -u root -proot -e "USE employees; SELECT COUNT(*) FROM employees;"
```

## Prerequisites

**For native installation:**
Requires MySQL 5.0+ with the following privileges:
- SELECT, INSERT, UPDATE, DELETE
- CREATE, DROP, RELOAD, REFERENCES
- INDEX, ALTER, SHOW DATABASES
- CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW

**For Docker development:**
Requires Docker and Docker Compose installed on your system.

## License and Disclaimer

Licensed under Creative Commons Attribution-Share Alike 3.0 Unported License. The data is fabricated and does not correspond to real people.